# Архитектура системы

## Обзор

Система построена на микросервисной архитектуре и состоит из 5 независимых сервисов, взаимодействующих через HTTP API.

## Диаграмма архитектуры

```
┌─────────────────┐
│  Frontend       │  (Порт 8080)
│  Service        │
└────────┬────────┘
         │ HTTP
         ▼
┌─────────────────┐
│  API Gateway    │  (Порт 5000)
│  (Frontend)     │
└─────┬─────┬─────┘
      │     │     │
      │     │     │ HTTP
      ▼     ▼     ▼
┌─────────┐ ┌──────────┐ ┌──────────┐
│  Auth   │ │  Course  │ │ Learning │
│ Service │ │ Service  │ │ Service  │
│(Backend)│ │(Backend) │ │(Backend) │
│ :5001   │ │ :5002    │ │ :5003    │
└─────────┘ └──────────┘ └──────────┘
```

## Микросервисы

### 1. Auth Service (Backend)
**Порт:** 5001  
**Ответственность:**
- Регистрация и аутентификация пользователей
- Генерация и валидация JWT токенов
- Управление пользователями и ролями
- Хранение учетных данных

**База данных:** SQLite (auth.db)

**API Endpoints:**
- `POST /register` - Регистрация
- `POST /login` - Вход (возвращает JWT)
- `POST /validate` - Валидация токена
- `GET /user/<id>` - Информация о пользователе
- `GET /users` - Список пользователей

### 2. Course Service (Backend)
**Порт:** 5002  
**Ответственность:**
- Создание и управление курсами
- Публикация курсов
- Получение информации о курсах
- Интеграция с Auth Service для проверки прав доступа

**База данных:** SQLite (courses.db)

**Зависимости:** Auth Service

**API Endpoints:**
- `GET /courses` - Список опубликованных курсов
- `GET /courses/my` - Мои курсы
- `POST /courses` - Создать курс
- `GET /courses/<id>` - Информация о курсе
- `PUT /courses/<id>` - Обновить курс
- `DELETE /courses/<id>` - Удалить курс

### 3. Learning Service (Backend)
**Порт:** 5003  
**Ответственность:**
- Управление уроками
- Записи студентов на курсы
- Отслеживание прогресса обучения
- Управление прохождением уроков

**База данных:** SQLite (learning.db)

**Зависимости:** Auth Service, Course Service

**API Endpoints:**
- `GET /courses/<id>/lessons` - Уроки курса
- `POST /courses/<id>/lessons` - Создать урок
- `GET /lessons/<id>` - Информация об уроке
- `POST /courses/<id>/enroll` - Записаться на курс
- `GET /users/<id>/enrollments` - Курсы пользователя
- `POST /lessons/<id>/complete` - Отметить урок как пройденный

### 4. API Gateway (Frontend)
**Порт:** 5000  
**Ответственность:**
- Единая точка входа для всех API запросов
- Маршрутизация запросов к соответствующим backend сервисам
- Проксирование запросов
- CORS поддержка

**Зависимости:** Все backend сервисы

**API Endpoints:**
- Все endpoints доступны через префикс `/api`
- Автоматическая маршрутизация к нужному сервису

### 5. Frontend Service (Frontend)
**Порт:** 8080  
**Ответственность:**
- Веб-интерфейс приложения
- Отображение курсов и уроков
- Взаимодействие с пользователем
- Коммуникация с API Gateway

**Зависимости:** API Gateway

## Взаимодействие сервисов

### Аутентификация
1. Пользователь отправляет запрос на `/api/auth/login` через API Gateway
2. API Gateway перенаправляет запрос в Auth Service
3. Auth Service проверяет учетные данные и возвращает JWT токен
4. Токен сохраняется в localStorage клиента

### Создание курса
1. Преподаватель отправляет POST запрос на `/api/courses` с JWT токеном
2. API Gateway проверяет токен через Auth Service
3. API Gateway перенаправляет запрос в Course Service
4. Course Service создает курс и возвращает результат

### Просмотр курса
1. Пользователь запрашивает `/api/courses/<id>`
2. API Gateway перенаправляет в Course Service
3. Course Service возвращает информацию о курсе
4. Для загрузки уроков делается отдельный запрос в Learning Service

## Базы данных

Каждый backend сервис имеет свою собственную базу данных:
- **Auth Service:** auth.db (пользователи)
- **Course Service:** courses.db (курсы)
- **Learning Service:** learning.db (уроки, записи, прогресс)

## Безопасность

- JWT токены для аутентификации
- Валидация токенов на каждом защищенном endpoint
- Проверка прав доступа на уровне сервисов
- CORS настройки для безопасного взаимодействия

## Масштабирование

Каждый сервис может масштабироваться независимо:
- Можно запустить несколько экземпляров каждого сервиса
- Балансировка нагрузки через API Gateway
- Горизонтальное масштабирование

## Развертывание

### Docker Compose
Все сервисы упакованы в Docker контейнеры и могут быть запущены одной командой:
```bash
docker-compose up
```

### Облачные платформы
Система готова к развертыванию на:
- Docker Swarm (локально или multi-host)
- AWS ECS
- Google Cloud Run
- Azure Container Instances
- Heroku (с Docker)

